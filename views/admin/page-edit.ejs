<%- include("./include/header") %>
    <!--Main content-->
    <div class="site-body">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb bg-transparent mb-0">
                <li class="breadcrumb-item"><a href="/<%=dashboard%>"><i class="fas fa-home"></i> Dashboard</a></li>
                <li class="breadcrumb-item"><a href="/<%=dashboard%>/post/<%=type.id%>"><%=type.name%></a></li>
                <li class="breadcrumb-item active" aria-current="page">Edit</li>
            </ol>
        </nav>
        <div class="container-fluid">
            <form id="post-form-edit" action="/<%=dashboard%>/post/<%=posttype%>/edit/<%=post.id%>" method="post">
                <div class="row">
                    <div class="col-12">
                        <%- include("./templates/box-post-language")%>
                    </div>
                </div>
                <div class="row sortable-wrapper" id="PageEditScreen">
                    <!-- Left Side -->
                    <div class="col-lg-9 col-md-12">                        
                        <div id="ls-sortable" class="sortable">
                            <div class="accordion accordion-ui ui-state-default mb-3" id="accordionMainPost">
                                <div class="card">
                                    <div class="card-header" id="headingMainPost">
                                        <h2 class="mb-0">
                                            <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapseMainPost" aria-expanded="true" aria-controls="collapseMainPost">
                                                Content
                                            </button>
                                        </h2>
                                    </div>
                                    <div id="collapseMainPost" class="collapse show" aria-labelledby="headingMainPost" data-parent="#accordionMainPost">
                                        <div class="card-body">
                                            <div class="form-group">
                                                <label for="title">Tittle</label>
                                                <input type="hidden" class="form-control" name="id" placeholder="ID" value="<%=post.id%>">
                                                <input type="text" class="form-control" name="title" placeholder="Tittle" value="<%=post.title%>">
                                            </div>
                                            <div class="form-group">
                                                <label for="slug">Slug</label>
                                                <input type="text" class="form-control" name="slug" id="slug" placeholder="Slug" value="<%=post.slug%>">
                                            </div>
                                            <div class="form-group">
                                                <label for="description">Description</label>
                                                <textarea class="form-control" name="description" placeholder="Description"><%=post.description%></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="content">Content</label>
                                                <textarea class="form-control tinymce" name="content" placeholder="Content"><%=post.content%></textarea>
                                            </div>
                                            <div class="row mt-2 mb-3">
                                                <div class="col">
                                                    <div class="checkbox mr-5">
                                                        <input class="form-check-input" type="checkbox" name="islikemain" <%if(post.islikemain){ %>checked<%}%>>
                                                        <label class="form-check-label" for="islikemain">Dùng ngôn ngữ chính làm mặc định cho tất cả ngôn ngữ</label>
                                                    </div>
                                                    <div class="checkbox">
                                                        <input class="form-check-input" type="checkbox" name="nolink" <%if(post.nolink){ %>checked<%}%>>
                                                        <label class="form-check-label" for="nolink">Bài viết không có URL</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion accordion-ui ui-state-default mb-3" id="accordionSeoPost">
                                <div class="card">
                                    <div class="card-header" id="headingSeoPost">
                                        <h2 class="mb-0">
                                            <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapseSeoPost" aria-expanded="true" aria-controls="collapseSeoPost">
                                                Seo
                                            </button>
                                        </h2>
                                    </div>
                                    <div id="collapseSeoPost" class="collapse show" aria-labelledby="headingSeoPost" data-parent="#accordionSeoPost">
                                        <div class="card-body">
                                            <div class="form-group seo-progress-bar">
                                                <label for="seotitle">Seo Title</label>
                                                <input type="text" class="form-control seo-progress-text" name="seotitle" placeholder="Seo Title" value="<%=post.seotitle%>">
                                                <div class="progress">
                                                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuegood="40" aria-valuemin="0" aria-valuemax="65"></div>
                                                </div>
                                            </div>
                                            <div class="form-group seo-progress-bar">
                                                <label for="seodescription">Seo Description</label>
                                                <textarea class="form-control seo-progress-text" name="seodescription" placeholder="Seo Description"><%=post.seodescription%></textarea>
                                                <div class="progress">
                                                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuegood="125" aria-valuemin="0" aria-valuemax="155"></div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="seoschema">SEO Schema</label>
                                                <textarea class="form-control" name="seoschema" placeholder="SEO Schema"><%=post.seoschema%></textarea>
                                            </div>
                                            <div class="row mt-2 mb-3">
                                                <div class="col">
                                                    <div class="checkbox">
                                                        <input class="form-check-input" type="checkbox" name="allowindex" <%if(post.allowindex){ %>checked<%}%>>
                                                        <label class="form-check-label" for="allowindex">Bật index</label>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div class="checkbox">
                                                        <input class="form-check-input" type="checkbox" name="allowfollow" <%if(post.allowfollow){ %>checked<%}%>>
                                                        <label class="form-check-label" for="allowfollow">Bật follow</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion accordion-ui ui-state-default mb-3" id="accordionAdsPost">
                                <div class="card">
                                    <div class="card-header" id="headingAdsPost">
                                        <h2 class="mb-0">
                                            <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapseAdsPost" aria-expanded="true" aria-controls="collapseAdsPost">
                                                Ads
                                            </button>
                                        </h2>
                                    </div>
                                    <div id="collapseAdsPost" class="collapse show" aria-labelledby="headingAdsPost" data-parent="#accordionAdsPost">
                                        <div class="card-body">
                                            <div class="form-group">
                                                <label for="ads">Ads code</label>
                                                <select class="form-control" name="ads">
                                                    <option value="">None</option>
                                                    <% if(adss){%>                                    
                                                        <% adss.forEach(item => { %>
                                                            <option value="<%=item.id%>" <%if(post.adsid==item.id){ %>selected<%}%>><%=item.name%></option>
                                                        <% }) %>
                                                    <%}%>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <div>
                                                    <div class="checkbox">
                                                        <input class="form-check-input" type="checkbox" name="offadsall" <%if(post.offadsall){ %>checked<%}%>>
                                                        <label class="form-check-label" for="offadsall">Tắt Quảng cáo tất cả ngông ngữ</label>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="checkbox">
                                                        <input class="form-check-input" type="checkbox" name="offads" <%if(post.offads){ %>checked<%}%>>
                                                        <label class="form-check-label" for="offads">Tắt Quảng cáo trang ngôn ngữ TBN</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="adsslot1">Ads slot 1</label>
                                                <textarea class="form-control" name="adsslot1" placeholder="Ads slot"><%=post.adsslot1%></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="adsslot2">Ads slot 2</label>
                                                <textarea class="form-control" name="adsslot2" placeholder="Ads slot"><%=post.adsslot2%></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="adsslot3">Ads slot 3</label>
                                                <textarea class="form-control" name="adsslot3" placeholder="Ads slot"><%=post.adsslot3%></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="adsslot4">Ads slot 4</label>
                                                <textarea class="form-control" name="adsslot4" placeholder="Ads slot"><%=post.adsslot4%></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <%- include("./templates/box-logging") %>
                        </div>
                    </div>
                    <!-- Right Side -->
                    <div class="col-lg-3 col-md-12">
                        <div id="rs-sortable" class="sortable stick-when-scroll">
                            <div class="accordion accordion-ui ui-state-default mb-3" id="accordionPostPublished">
                                <div class="card">
                                    <div class="card-header" id="headingOne">
                                        <h2 class="mb-0">
                                            <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapsePostPublished" aria-expanded="true" aria-controls="collapsePostPublished">
                                                Publish
                                            </button>
                                        </h2>
                                    </div>
                                    <div id="collapsePostPublished" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionPostPublished">
                                        <div class="card-body">
                                            <div class="form-group">
                                                <span>Status</span>
                                                <select name="poststatus">
                                                <option value="pendding" <%if(post.poststatus=='pendding'){ %>selected<%}%>>Private</option>
                                                <option value="published" <%if(post.poststatus=='published'){ %>selected<%}%>>Public</option>
                                                <option value="trash" <%if(post.poststatus=='trash'){ %>selected<%}%>>Trash</option>
                                            </select>
                                            </div>
                                            <div class="form-group" id="timepublicform">
                                                <div>
                                                    <input class="maindatefield" type="hidden" name="publishedat" value="<%=post.publishedat%>">
                                                    <span id="timepublic">Public at <strong>a moment</strong></span>
                                                    <a href="javascript:void(0);" id="btn-timepublic" class="btn btn-outline-primary btn-sm">Change</a>
                                                </div>
                                                <div id="timepublicwrap">
                                                    <input type="text" name="tpf-day" placeholder="dd">
                                                    <select name="tpf-month">
                                                        <option value="1">01 - Jan</option>
                                                        <option value="2">02 - Feb</option>
                                                        <option value="3">03 - Mar</option>
                                                        <option value="4">04 - Apr</option>
                                                        <option value="5">05 - May</option>
                                                        <option value="6">06 - Jun</option>
                                                        <option value="7">07 - Jul</option>
                                                        <option value="8">08 - Aug</option>
                                                        <option value="9">09 - Sep</option>
                                                        <option value="10">10 - Oct</option>
                                                        <option value="11">11 - Nov</option>
                                                        <option value="12">12 - Dec</option>
                                                    </select>
                                                    <input type="text" name="tpf-year" placeholder="yyyy">
                                                    <input type="text" name="tpf-hour" placeholder="HH">
                                                    <span>:</span>
                                                    <input type="text" name="tpf-minute" placeholder="mm">
                                                    <p>
                                                        <a href="javascript:void(0);" id="btn-tpf-apply" class="btn btn-primary btn-sm">Ok</a>
                                                        <a href="javascript:void(0);" id="btn-tpf-cancel" class="btn btn-outline-dark btn-sm">Cancel</a>
                                                    </p>
                                                </div>
                                            </div>                                           
                                            <div class="form-group">                                                
                                                <%
                                                    var html = (post.posttype == "post-page") ? "/" : "/";
                                                %>
                                                <%if(post.poststatus=='published'){%>
                                                    <a href="/<%=post.slug%><%=html%>" target="_blank" class="btn btn-sm btn-outline-primary">View post</a>
                                                <%}else{%>
                                                    <a href="/?pid=<%=post.id%>&preview=1" target="_blank" class="btn btn-sm btn-outline-primary">Preview post</a>
                                                <%}%>                                                
                                                <a href="javascript:void(0);" class="btn btn-sm btn-outline-danger btn-reset-screenui float-right">Giao diện mặc định</a>
                                            </div>
                                            <div class="text-right">
                                                <input type="hidden" name="modifiedat" id="modifiedat" value="<%=post.modifiedat%>">
                                                <button class="btn btn-primary" id="btn-submit-editmodified">Update</button>
                                                <button class="btn btn-primary">Save</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% 
                                var arrPC = [];  
                                post.categories.forEach(item => { 
                                    arrPC.push(item.id);
                                });
                            %>
                            <% if(Object.keys(type.catetype).length > 0 && Object.keys(categories).length > 0){%>
                            <% type.catetype.forEach(catetype => { %>
                                <div class="accordion accordion-ui ui-state-default mb-3" id="accordion<%=catetype.id%>">
                                    <div class="card">
                                        <div class="card-header" id="heading<%=catetype.id%>">
                                            <h2 class="mb-0">
                                                <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapse<%=catetype.id%>" aria-expanded="true" aria-controls="collapse<%=catetype.id%>">
                                                    <%=catetype.name%>
                                                </button>
                                            </h2>
                                        </div>
                                        <div id="collapse<%=catetype.id%>" class="collapse show" aria-labelledby="heading<%=catetype.id%>" data-parent="#accordion<%=catetype.id%>">
                                            <div class="card-body">
                                                <% categories.forEach(item => { %>
                                                    <% if(catetype.id == item.catetype){%>
                                                        <div class="form-group">
                                                            <div class="checkbox">
                                                                <input type="checkbox" name="categories[]" value="<%=item.id%>" <%if(arrPC.includes(item.id)){ %>checked<%}%>>
                                                                <label for="categories[]"><%=item.title%></label>
                                                            </div>
                                                        </div>
                                                        <% item.Childrens.forEach(child => { %>
                                                            <div class="ml-3">
                                                                <div class="form-group">
                                                                    <div class="checkbox">
                                                                        <input type="checkbox" name="categories[]" value="<%=child.id%>" <%if(arrPC.includes(child.id)){ %>checked<%}%>>
                                                                        <label for="categories[]"><%=child.title%></label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        <% }) %>
                                                    <%}%>
                                                <% }) %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <% }) %>
                            <%}%>                        
                            <div class="accordion accordion-ui ui-state-default mb-3" id="accordionPageTemplate">
                                <div class="card">
                                    <div class="card-header" id="headingPageTemplate">
                                        <h2 class="mb-0">
                                            <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapsePageTemplate" aria-expanded="true" aria-controls="collapsePageTemplate">
                                                Template
                                            </button>
                                        </h2>
                                    </div>
                                    <div id="collapsePageTemplate" class="collapse show" aria-labelledby="headingPageTemplate" data-parent="#accordionPageTemplate">
                                        <div class="card-body mm-wrapper">
                                            <select class="form-control" name="template" id="template">
                                                <option value="">Default</option>
                                                <option value="single-page-dmca" <%if(post.template=="single-page-dmca"){%>selected<%}%>>DMCA</option>
                                                <option value="single-page-contact" <%if(post.template=="single-page-contact"){%>selected<%}%>>Contact</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion accordion-ui ui-state-default mb-3" id="accordionPostThumbnail">
                                <div class="card">
                                    <div class="card-header" id="headingOne">
                                        <h2 class="mb-0">
                                            <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapsePostThumbnail" aria-expanded="true" aria-controls="collapsePostThumbnail">
                                                Thumbnail
                                            </button>
                                        </h2>
                                    </div>
                                    <div id="collapsePostThumbnail" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionPostThumbnail">
                                        <div class="card-body mm-wrapper">
                                            <div class="mm-img-holder">
                                                <%
                                                    if(post.thumb){
                                                        %>
                                                    <input type="hidden" name="thumb" value="<%=post.thumb.id%>">
                                                    <div class="thumb">
                                                        <img src="<%=post.thumb.url%>">
                                                    </div>
                                                    <%
                                                    }else{
                                                        %>
                                                        <input type="hidden" name="thumb" value="">
                                                        <div class="thumb"></div>
                                                        <%
                                                    }
                                                %>
                                            </div>
                                            <a class="btn btn-outline-primary btn-sm mt-3" href="javascript:void(0);" onclick="mmInit(false, false,'thumbnail', true, this);">Choose thumbnail</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- Modal Upload Image -->
    <div class="modal fade" id="editorImgModal" tabindex="-1" aria-labelledby="editorImgModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editorImgModalLabel">Add Media</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
                <div class="modal-body">
                    <div id="tabs">
                        <ul>
                            <li><a href="#tabs-upload">Upload files</a></li>
                            <li><a href="#tabs-media">Media</a></li>
                            <li><a href="#tabs-url">From Url</a></li>
                        </ul>
                        <div id="tabs-upload">

                        </div>
                        <div id="tabs-media" data-offset="0">
                            <ol id="selectableImgList"></ol>
                        </div>
                        <div id="tabs-url">
                            <div class="form-group">
                                <label for="imgUrl">Image url</label>
                                <input class="form-control" type="text" name="imgUrl" placeholder="Image url">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="btnEditorImg" class="btn btn-primary">Apply</button>
                </div>
            </div>
        </div>
    </div>
    <script>var curPostType = "<%=posttype%>";</script>
    <script src="/<%=dashboard%>/assets/libs/jquery-ui-1.12.1/jquery-ui.min.js"></script>
    <script src="/<%=dashboard%>/assets/libs/tinymce/tinymce.min.js"></script>
    <script src="/<%=dashboard%>/assets/js/tiny.js"></script>
    <script src="/<%=dashboard%>/assets/js/userui.js"></script>    
    <%- include("./include/footer") %>