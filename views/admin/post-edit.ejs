<%- include("./include/header") %>
    <!--Main content-->
    <div class="site-body">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb bg-transparent mb-0">
                <li class="breadcrumb-item"><a href="/<%=dashboard%>"><i class="fas fa-home"></i> Dashboard</a></li>
                <li class="breadcrumb-item"><a href="/<%=dashboard%>/post/<%=type.id%>"><%=type.name%></a></li>
                <li class="breadcrumb-item active" aria-current="page">Edit</li>
            </ol>
        </nav>
        <div class="container-fluid">
            <form id="post-form-edit" action="/<%=dashboard%>/post/<%=posttype%>/edit/<%=post.id%>" method="post">
                <div class="row">
                    <div class="col-12">
                        <%- include("./templates/box-post-language")%>
                    </div>
                </div>
                <div class="row sortable-wrapper" id="PostEditScreen">
                    <!-- Left Side -->
                    <div class="col-lg-9 col-md-12">                        
                        <div id="ls-sortable" class="sortable">  
                            <div class="accordion accordion-ui ui-state-default mb-3" id="accordionMainPost">
                                <div class="card">
                                    <div class="card-header" id="headingMainPost">
                                        <h2 class="mb-0">
                                            <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapseMainPost" aria-expanded="true" aria-controls="collapseMainPost">
                                                Content
                                            </button>
                                        </h2>
                                    </div>
                                    <div id="collapseMainPost" class="collapse show" aria-labelledby="headingMainPost" data-parent="#accordionMainPost">
                                        <div class="card-body">
                                            <div class="form-group">
                                                <label for="title">Tittle</label>
                                                <input type="hidden" class="form-control" name="id" placeholder="ID" value="<%=post.id%>">
                                                <input type="text" class="form-control" name="title" placeholder="Tittle" value="<%=post.title%>">
                                            </div>
                                            <div class="form-group">
                                                <label for="slug">Slug</label>
                                                <input type="text" class="form-control" name="slug" id="slug" placeholder="Slug" value="<%=post.slug%>">
                                            </div>
                                            <div class="form-group">
                                                <label for="description">Description</label>
                                                <textarea class="form-control" name="description" placeholder="Description"><%=post.description%></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="content">Content</label>
                                                <textarea class="form-control tinymce" name="content" placeholder="Content"><%=post.content%></textarea>
                                            </div>
                                            <div class="row mt-2 mb-3">
                                                <div class="col">
                                                    <div class="checkbox">
                                                        <input class="form-check-input" type="checkbox" name="islikemain" <%if(post.islikemain){ %>checked<%}%>>
                                                        <label class="form-check-label" for="islikemain">Dùng nội dung English làm mặc định cho tất cả ngôn ngữ</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mt-2 mb-3">
                                                <div class="col">
                                                    <div class="checkbox">
                                                        <input class="form-check-input" type="checkbox" name="notenglish" <%if(post.notenglish==true){%>checked<%}%>>
                                                        <label class="form-check-label" for="notenglish">Không dùng English</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>                          
                            <div class="accordion accordion-ui ui-state-default mb-3" id="accordionSeoPost">
                                <div class="card">
                                    <div class="card-header" id="headingSeoPost">
                                        <h2 class="mb-0">
                                            <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapseSeoPost" aria-expanded="true" aria-controls="collapseSeoPost">
                                                Seo
                                            </button>
                                        </h2>
                                    </div>
                                    <div id="collapseSeoPost" class="collapse show" aria-labelledby="headingSeoPost" data-parent="#accordionSeoPost">
                                        <div class="card-body">
                                            <div class="form-group seo-progress-bar">
                                                <label for="seotitle">SEO Title</label>
                                                <input type="text" class="form-control seo-progress-text" name="seotitle" placeholder="SEO Title" value="<%=post.seotitle%>">
                                                <div class="progress">
                                                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuegood="40" aria-valuemin="0" aria-valuemax="65"></div>
                                                </div>
                                            </div>
                                            <div class="form-group seo-progress-bar">
                                                <label for="seodescription">SEO Description</label>
                                                <textarea class="form-control seo-progress-text" name="seodescription" placeholder="SEO Description"><%=post.seodescription%></textarea>
                                                <div class="progress">
                                                    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuegood="125" aria-valuemin="0" aria-valuemax="155"></div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="seoschema">SEO Schema</label>
                                                <textarea class="form-control" name="seoschema" placeholder="SEO Schema"><%=post.seoschema%></textarea>
                                            </div>
                                            <div class="row mt-2 mb-3">
                                                <div class="col">
                                                    <div class="checkbox">
                                                        <input class="form-check-input" type="checkbox" name="allowindex" <%if(post.allowindex){ %>checked<%}%>>
                                                        <label class="form-check-label" for="allowindex">Bật index</label>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div class="checkbox">
                                                        <input class="form-check-input" type="checkbox" name="allowfollow" <%if(post.allowfollow){ %>checked<%}%>>
                                                        <label class="form-check-label" for="allowfollow">Bật follow</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion accordion-ui ui-state-default mb-3" id="accordionAdsPost">
                                <div class="card">
                                    <div class="card-header" id="headingAdsPost">
                                        <h2 class="mb-0">
                                            <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapseAdsPost" aria-expanded="true" aria-controls="collapseAdsPost">
                                                Ads
                                            </button>
                                        </h2>
                                    </div>
                                    <div id="collapseAdsPost" class="collapse show" aria-labelledby="headingAdsPost" data-parent="#accordionAdsPost">
                                        <div class="card-body">
                                            <div class="form-group">
                                                <label for="ads">Ads code</label>
                                                <select class="form-control" name="ads">
                                                    <option value="">None</option>
                                                    <% if(adss){%>                                    
                                                        <% adss.forEach(item => { %>
                                                            <option value="<%=item.id%>" <%if(post.adsid==item.id){ %>selected<%}%>><%=item.name%></option>
                                                        <% }) %>
                                                    <%}%>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <div>
                                                    <div class="checkbox">
                                                        <input class="form-check-input" type="checkbox" name="offadsall" <%if(post.offadsall){ %>checked<%}%>>
                                                        <label class="form-check-label" for="offadsall">Tắt Quảng cáo tất cả ngôn ngữ</label>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="checkbox">
                                                        <input class="form-check-input" type="checkbox" name="offads" <%if(post.offads){ %>checked<%}%>>
                                                        <label class="form-check-label" for="offads">Tắt Quảng cáo trang TBN</label>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="checkbox">
                                                        <input class="form-check-input" type="checkbox" name="offadscontent" <%if(post.offadscontent==true){%>checked<%}%>>
                                                        <label class="form-check-label" for="offadscontent">Tắt Quảng cáo trong Bài viết</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--
                                            <div class="form-group">
                                                <label for="adsslot1">Ads slot 1</label>
                                                <textarea class="form-control" name="adsslot1" placeholder="Ads slot"><%=post.adsslot1%></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="adsslot2">Ads slot 2</label>
                                                <textarea class="form-control" name="adsslot2" placeholder="Ads slot"><%=post.adsslot2%></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="adsslot3">Ads slot 3</label>
                                                <textarea class="form-control" name="adsslot3" placeholder="Ads slot"><%=post.adsslot3%></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="adsslot4">Ads slot 4</label>
                                                <textarea class="form-control" name="adsslot4" placeholder="Ads slot"><%=post.adsslot4%></textarea>
                                            </div>
                                            -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion accordion-ui ui-state-default mb-3 boxPopupAccordion" id="accordionFaq" data-popup="apkFaqModal">
                                <div class="card">
                                    <div class="card-header" id="headingFaq">
                                        <h2 class="mb-0">
                                            <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapseFaq" aria-expanded="true" aria-controls="collapseFaq">
                                                FAQs
                                            </button>
                                        </h2>
                                    </div>
                                    <div id="collapseFaq" class="collapse show" aria-labelledby="headingFaq" data-parent="#accordionFaq">
                                        <div class="card-body">
                                            <div class="faq-box" data-post="pid">
                                                <div class="text-right">
                                                    <button class="btn btn-primary btn-sm rounded-circle btn-show-popform" title="Add Faq">
                                                        <i class="fas fa-plus"></i>
                                                    </button>
                                                </div>
                                                <div class="mb-body">
                                                    <div class="bpaSortable" data-link="/<%=dashboard%>/post/<%=post.posttype%>/faq/numsort">
                                                        <%
                                                            var faqs = (post.faq) ? post.faq : [];
                                                            faqs.forEach(faq => {
                                                        %>
                                                                <div class="bpaItem ui-state-default mb-3" id="accordionFaq-<%=faq.id%>" data-id="<%=faq.id%>">
                                                                    <div class="bpa-toolbar">
                                                                        <button class="btn btn-danger btn-sm rounded-0 btnDelBPA" title="Remove it"><i class="fas fa-times"></i></button>
                                                                        <span class="bpa-title"><%=faq.title%></span>
                                                                    </div>
                                                                    <div class="bpa-body card rounded-0">
                                                                        <div class="form-group">
                                                                            <label for="">Hỏi</label>
                                                                            <input class="form-control" type="hidden" name="faqid" value="<%=faq.id%>">
                                                                            <input class="form-control" type="hidden" name="faqpid" value="<%=faq.postid%>">
                                                                            <input class="form-control" type="hidden" name="faqlangid" value="<%=faq.langid%>">
                                                                            <input class="form-control" type="hidden" name="faqnumsort" value="<%=faq.numsort%>">
                                                                            <input class="form-control itemAutoSave bpai-title" type="text" name="faqtitle" placeholder="Hỏi" value="<%=faq.title%>">
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label for="">Trả lời</label>
                                                                            <textarea class="form-control bpatinymce itemAutoSave bpa-change-item bpai-content" name="faqcontent" placeholder="Trả lời"><%=faq.content%></textarea>
                                                                        </div>
                                                                    </div>
                                                                    <div class="bpa-footer"></div>
                                                                </div>
                                                        <%
                                                            });
                                                        %>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <%- include("./templates/box-logging") %>
                        </div>
                    </div>
                    <!-- Right Side -->
                    <div class="col-lg-3 col-md-12">
                        <div id="rs-sortable" class="sortable stick-when-scroll">
                            <div class="accordion accordion-ui ui-state-default mb-3" id="accordionPostPublished">
                                <div class="card">
                                    <div class="card-header" id="headingOne">
                                        <h2 class="mb-0">
                                            <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapsePostPublished" aria-expanded="true" aria-controls="collapsePostPublished">
                                                Publish
                                            </button>
                                        </h2>
                                    </div>
                                    <div id="collapsePostPublished" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionPostPublished">
                                        <div class="card-body">
                                            <div class="form-group">
                                                <span>Status</span>
                                                <select name="poststatus">
                                                <option value="pendding" <%if(post.poststatus=='pendding'){ %>selected<%}%>>Private</option>
                                                <option value="published" <%if(post.poststatus=='published'){ %>selected<%}%>>Public</option>
                                                <option value="trash" <%if(post.poststatus=='trash'){ %>selected<%}%>>Trash</option>
                                            </select>
                                            </div>
                                            <div class="form-group" id="timepublicform">
                                                <div>
                                                    <input class="maindatefield" type="hidden" name="publishedat" value="<%=post.publishedat%>">
                                                    <span id="timepublic">Public <strong>ngay</strong></span>
                                                    <a href="javascript:void(0);" id="btn-timepublic" class="btn btn-outline-primary btn-sm">Change</a>
                                                </div>
                                                <div id="timepublicwrap">
                                                    <input type="text" name="tpf-day" placeholder="dd">
                                                    <select name="tpf-month">
                                                        <option value="1">01 - Jan</option>
                                                        <option value="2">02 - Feb</option>
                                                        <option value="3">03 - Mar</option>
                                                        <option value="4">04 - Apr</option>
                                                        <option value="5">05 - May</option>
                                                        <option value="6">06 - Jun</option>
                                                        <option value="7">07 - Jul</option>
                                                        <option value="8">08 - Aug</option>
                                                        <option value="9">09 - Sep</option>
                                                        <option value="10">10 - Oct</option>
                                                        <option value="11">11 - Nov</option>
                                                        <option value="12">12 - Dec</option>
                                                    </select>
                                                    <input type="text" name="tpf-year" placeholder="yyyy">
                                                    <input type="text" name="tpf-hour" placeholder="HH">
                                                    <span>:</span>
                                                    <input type="text" name="tpf-minute" placeholder="mm">
                                                    <p>
                                                        <a href="javascript:void(0);" id="btn-tpf-apply" class="btn btn-primary btn-sm">Ok</a>
                                                        <a href="javascript:void(0);" id="btn-tpf-cancel" class="btn btn-outline-dark btn-sm">Cancel</a>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <%
                                                    var html = (post.posttype == "post-page") ? "/" : "/";
                                                %>
                                                <%if(post.poststatus=='published'){%>
                                                    <a href="/<%=post.slug%><%=html%>" target="_blank" class="btn btn-sm btn-outline-primary">View post</a>
                                                <%}else{%>
                                                    <a href="/?pid=<%=post.id%>&preview=1" target="_blank" class="btn btn-sm btn-outline-primary">Preview post</a>
                                                <%}%>                                                
                                                <a href="javascript:void(0);" class="btn btn-sm btn-outline-danger btn-reset-screenui float-right">Giao diện mặc định</a>
                                            </div>
                                            <div class="text-right">
                                                <input type="hidden" name="modifiedat" id="modifiedat" value="<%=post.modifiedat%>">
                                                <button class="btn btn-primary" id="btn-submit-editmodified">Update</button>
                                                <button class="btn btn-primary">Save</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <%- include("./templates/box-post-categories") %>                      
                            <div class="accordion accordion-ui ui-state-default mb-3" id="accordionPostThumbnail">
                                <div class="card">
                                    <div class="card-header" id="headingOne">
                                        <h2 class="mb-0">
                                            <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapsePostThumbnail" aria-expanded="true" aria-controls="collapsePostThumbnail">
                                                Thumbnail
                                            </button>
                                        </h2>
                                    </div>
                                    <div id="collapsePostThumbnail" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionPostThumbnail">
                                        <div class="card-body mm-wrapper">
                                            <div class="mm-img-holder">
                                                <%
                                                    if(post.thumb){
                                                %>
                                                    <input type="hidden" name="thumb" value="<%=post.thumb.id%>">
                                                    <div class="thumb">
                                                        <img src="<%=post.thumb.url%>">
                                                    </div>
                                                <%
                                                    }else{
                                                %>
                                                        <input type="hidden" name="thumb" value="">
                                                        <div class="thumb"></div>
                                                <%
                                                    }
                                                %>
                                            </div>
                                            <a class="btn btn-outline-primary btn-sm mt-3" href="javascript:void(0);" onclick="mmInit(false, false,'thumbnail', true, this);">Choose thumbnail</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- Modal Upload Image -->
    <div class="modal fade" id="editorImgModal" tabindex="-1" aria-labelledby="editorImgModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editorImgModalLabel">Add Media</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
                <div class="modal-body">
                    <div id="tabs">
                        <ul>
                            <li><a href="#tabs-upload">Upload files</a></li>
                            <li><a href="#tabs-media">Media</a></li>
                            <li><a href="#tabs-url">From Url</a></li>
                        </ul>
                        <div id="tabs-upload">

                        </div>
                        <div id="tabs-media" data-offset="0">
                            <ol id="selectableImgList"></ol>
                        </div>
                        <div id="tabs-url">
                            <div class="form-group">
                                <label for="imgUrl">Image url</label>
                                <input class="form-control" type="text" name="imgUrl" placeholder="Image url">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="btnEditorImg" class="btn btn-primary">Apply</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal FAQ -->
    <div class="modal fade bpaModal" id="apkFaqModal" tabindex="-1" aria-labelledby="faqModalLabel" aria-hidden="true" data-box="accordionFaq">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <form action="/<%=dashboard%>/post/<%=posttype%>/faq/add" class="bpaForm">
                    <div class="modal-header">
                        <h5 class="modal-title bpaModalLabel" id="faqModalLabel">Add FAQ</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="">Hỏi</label>                        
                            <input class="form-control" type="hidden" name="postid" value="<%=post.id%>">
                            <input class="form-control" type="hidden" name="langid" value="es">
                            <input class="form-control" type="text" name="title" placeholder="Hỏi" required>
                        </div>
                        <div class="form-group">
                            <label for="">Trả lời</label>
                            <textarea class="form-control tinymce bpa-change-item" name="content" placeholder="Trả lời"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary bpaSubmit">Lưu</button>
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Hủy</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>var curPostType = "<%=posttype%>";</script>
    <script src="/<%=dashboard%>/assets/libs/jquery-ui-1.12.1/jquery-ui.min.js"></script>
    <script src="/<%=dashboard%>/assets/libs/tinymce/tinymce.min.js"></script>
    <script src="/<%=dashboard%>/assets/js/tiny.js"></script>
    <script src="/<%=dashboard%>/assets/js/userui.js"></script>
    <script src="/<%=dashboard%>/assets/js/boxFaqs.js"></script>
    <%- include("./include/footer") %>